<!doctype html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Laudem Dei Chamber Choir ‚Äî Tickets</title>
  <meta name="description" content="Buy tickets for Laudem Dei Chamber Choir. Mobile-friendly page with client-side checkout." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    .glass { background: rgba(255,255,255,.72); backdrop-filter: blur(12px); }
    .ticket-card{ transition: box-shadow .2s ease, transform .2s ease; }
    .ticket-card:active{ transform: translateY(1px); }
    .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
  </style>
</head>
<body class="bg-white text-slate-800">
  <script>
    // ===== Shared Config (persisted to localStorage) =====
    const DEFAULT_CONFIG = {
      orgName: "Laudem Dei Chamber Choir",
      logoUrl: "https://laudemdeitickets.github.io/choir-tickets/logo.jpeg",
      event: {
        id: "choir-2025-spring-concert",
        title: "Spring Serenade Concert",
        subtitle: "An evening of choral gems",
        dateISO: "2025-10-11T18:30:00+02:00",
        doorsISO: "2025-10-11T18:00:00+02:00",
        venue: "St. Stithians Chapel",
        address: "40 Peter Place, Lyme Park, Sandton, 2191",
        mapLink: "https://maps.google.com/?q=St.+Stithians+Chapel+Sandton",
        heroImg: "https://placehold.co/1200x800/png?text=Choir+Concert",
        heroAlt: "Choir on stage"
      },
      tickets: [
        { code: "GEN",  name: "General Admission",    price: 20000,  desc: "Unreserved seating",          limit: 10 },
        { code: "STUD", name: "Student / Pensioner", price: 12000,  desc: "ID required at door",        limit: 10 },
        { code: "VIP",  name: "Patron (Front Rows)", price: 35000,  desc: "Priority seating + program", limit: 10 }
      ],
      currency: 'ZAR'
    };

    const STORAGE_KEYS = {
      CONFIG: 'choir_config_override',
      CART:   'choir_cart'
    };

    function loadConfig(){
      try { const s = localStorage.getItem(STORAGE_KEYS.CONFIG); if (s){ const o = JSON.parse(s); // shallow-merge to keep defaults if fields missing
        const cfg = structuredClone(DEFAULT_CONFIG);
        Object.assign(cfg, o);
        if (o.event) Object.assign(cfg.event, o.event);
        if (o.tickets) cfg.tickets = o.tickets;
        return cfg;
      }} catch(_){ }
      return structuredClone(DEFAULT_CONFIG);
    }
    const CONFIG = loadConfig();

    // ===== Utilities =====
    const ZAR = new Intl.NumberFormat('en-ZA', { style:'currency', currency:'ZAR', maximumFractionDigits:0 });
    const fmt = (cents) => ZAR.format(cents/100);
    const qs = (s,r) => (r||document).querySelector(s);
    const qsa = (s,r) => Array.from((r||document).querySelectorAll(s));
    const toHuman = (iso) => new Intl.DateTimeFormat(undefined,{weekday:'short',year:'numeric',month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'}).format(new Date(iso));
  </script>

  <!-- Header -->
  <header class="sticky top-0 z-30 bg-white/90 backdrop-blur border-b border-slate-200">
    <nav class="relative max-w-5xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <img id="brandLogo" alt="Laudem Dei logo" class="h-14 w-14 sm:h-16 sm:w-16 rounded-2xl object-contain bg-white ring-1 ring-slate-200 p-1" />
        <div id="brandName" class="font-semibold text-sm sm:text-base"></div>
      </div>
      <div class="ml-auto flex items-center gap-2">
        <a href="#tickets" class="inline-flex items-center gap-2 px-3 sm:px-4 py-2 rounded-xl bg-sky-600 text-white text-sm sm:text-base hover:bg-sky-700">Buy</a>
        <a href="concertedit.html" class="px-3 py-2 rounded-lg border border-slate-300 bg-white/80 backdrop-blur text-slate-700 text-xs md:text-sm hover:bg-white">Edit concert</a>
      </div>
    </nav>
  </header>

  <!-- Hero -->
  <section class="bg-slate-50">
    <div class="max-w-5xl mx-auto px-4 py-6 sm:py-10 grid md:grid-cols-2 gap-6 items-center">
      <div>
        <h1 id="heroTitle" class="text-2xl sm:text-4xl font-extrabold leading-tight"></h1>
        <p id="heroSubtitle" class="mt-2 text-slate-600 text-sm sm:text-base"></p>
        <ul class="mt-4 text-slate-700 text-sm space-y-1">
          <li>üìç <a id="venueLink" href="#" class="underline decoration-sky-400 underline-offset-4 hover:decoration-sky-600"></a></li>
          <li>üóìÔ∏è <span id="dateHuman"></span> ‚Ä¢ Doors <span id="doorsHuman"></span></li>
        </ul>
      </div>
      <div class="relative">
        <img id="heroImg" alt="" class="rounded-2xl shadow-xl ring-1 ring-slate-200 w-full h-auto object-cover" />
      </div>
    </div>
  </section>

  <!-- Tickets -->
  <section id="tickets" class="py-8 sm:py-12">
    <div class="max-w-5xl mx-auto px-4">
      <h2 class="text-xl sm:text-3xl font-bold">Choose your tickets</h2>
      <p class="text-slate-600 mt-2 text-sm sm:text-base">Secure payments in ZAR. (Simulated here for testing.)</p>

      <div id="ticketGrid" class="mt-5 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6"></div>

      <!-- Desktop order card -->
      <div class="hidden md:grid mt-8 grid-cols-[1fr,420px] gap-6 items-start">
        <div class="text-sm text-slate-600">
          <h3 class="font-semibold text-slate-800 mb-2">About this concert</h3>
          <p>Experience a night of luminous choral music featuring works by South African and international composers.</p>
        </div>
        <aside class="glass rounded-2xl p-5 sm:p-6 border border-slate-200 sticky top-20">
          <h3 class="text-lg sm:text-xl font-semibold">Your order</h3>
          <div id="orderList" class="mt-3 text-sm text-slate-700 space-y-2">
            <p class="text-slate-500">No tickets selected yet.</p>
          </div>
          <hr class="my-3" />
          <div class="flex items-center justify-between text-base sm:text-lg font-semibold">
            <span>Total</span>
            <span id="total">R0</span>
          </div>
          <button id="payBtnDesktop" class="mt-4 w-full px-5 py-3 rounded-xl bg-sky-600 text-white font-semibold hover:bg-sky-700 disabled:opacity-40 disabled:cursor-not-allowed" disabled>Pay</button>
        </aside>
      </div>
    </div>
  </section>

  <!-- Details -->
  <section id="details" class="py-10 sm:py-14 bg-slate-50 border-t border-slate-200">
    <div class="max-w-5xl mx-auto px-4 grid md:grid-cols-3 gap-8">
      <div>
        <h3 class="text-xl font-semibold">When & Where</h3>
        <p class="mt-2 text-sm sm:text-base">üìç <span id="detailVenue"></span><br><span id="detailAddress"></span></p>
        <p class="mt-2 text-sm sm:text-base">üóìÔ∏è <span id="detailDate"></span></p>
        <a id="mapsBtn" class="inline-block mt-3 px-4 py-2 rounded-xl border border-slate-300 hover:bg-white text-sm" target="_blank">Open in Google Maps</a>
      </div>
      <div>
        <h3 class="text-xl font-semibold">Program Highlights</h3>
        <ul class="mt-2 list-disc ml-5 text-slate-700 text-sm sm:text-base">
          <li>South African contemporary works</li>
          <li>Classical favourites</li>
          <li>Audience sing‚Äëalong finale</li>
        </ul>
      </div>
      <div>
        <h3 class="text-xl font-semibold">Access</h3>
        <ul class="mt-2 list-disc ml-5 text-slate-700 text-sm sm:text-base">
          <li>Wheelchair‚Äëfriendly entry</li>
          <li>Assistive ushers available</li>
          <li>Restrooms near entrance</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- Mobile sticky checkout bar -->
  <div id="mobileBar" class="md:hidden fixed inset-x-0 bottom-0 z-40 bg-white/95 border-t border-slate-200 safe-bottom">
    <div class="max-w-5xl mx-auto px-4 py-3 flex items-center justify-between gap-3">
      <div class="text-sm">
        <div class="text-slate-500">Total</div>
        <div id="totalMobile" class="text-lg font-bold">R0</div>
      </div>
      <button id="payBtnMobile" class="flex-1 px-4 py-3 rounded-xl bg-sky-600 text-white font-semibold hover:bg-sky-700 disabled:opacity-40 disabled:cursor-not-allowed" disabled>Pay</button>
    </div>
  </div>

  <script>
    // ===== Page Logic =====
    function renderHeader(){
      qs('#brandName').textContent = CONFIG.orgName || '';
      qs('#heroTitle').textContent = CONFIG.event.title || '';
      qs('#heroSubtitle').textContent = CONFIG.event.subtitle || '';
      const venueLink = qs('#venueLink'); venueLink.href = CONFIG.event.mapLink; venueLink.textContent = CONFIG.event.venue || '';
      qs('#dateHuman').textContent = toHuman(CONFIG.event.dateISO);
      qs('#doorsHuman').textContent = new Intl.DateTimeFormat(undefined, {hour:'2-digit', minute:'2-digit'}).format(new Date(CONFIG.event.doorsISO));
      qs('#detailVenue').textContent = CONFIG.event.venue || '';
      qs('#detailAddress').textContent = CONFIG.event.address || '';
      qs('#detailDate').textContent = toHuman(CONFIG.event.dateISO);
      qs('#mapsBtn').href = CONFIG.event.mapLink || '#';
      const img = qs('#heroImg'); img.src = CONFIG.event.heroImg; img.alt = CONFIG.event.heroAlt || 'Event image';
      const logo = qs('#brandLogo'); logo.src = CONFIG.logoUrl; logo.setAttribute('crossorigin','anonymous');
    }

    const cart = new Map();
    function renderTickets(){
      const grid = qs('#ticketGrid'); grid.innerHTML='';
      CONFIG.tickets.forEach(t=>{
        const card = document.createElement('div');
        card.className = 'ticket-card rounded-2xl border border-slate-200 p-4 sm:p-6 active:scale-[.99]';
        card.innerHTML = `
          <div class="flex items-center justify-between gap-3">
            <div class="text-base sm:text-lg font-semibold">${t.name}</div>
            <div class="text-lg sm:text-xl font-bold">${fmt(t.price)}</div>
          </div>
          <p class="mt-1 text-sm text-slate-600">${t.desc||''}</p>
          <div class="mt-3 sm:mt-4 flex items-center gap-2">
            <button data-code="${t.code}" class="qtyDown px-4 py-2 rounded-lg border active:scale-[.98]">‚àí</button>
            <input data-code="${t.code}" type="number" inputmode="numeric" min="0" max="${t.limit||99}" value="0" class="qtyInput w-20 text-center border rounded-lg py-2 text-base" />
            <button data-code="${t.code}" class="qtyUp px-4 py-2 rounded-lg border active:scale-[.98]">+</button>
          </div>`;
        grid.appendChild(card);
      });
      qsa('.qtyUp').forEach(btn=>btn.addEventListener('click',()=>changeQty(btn.dataset.code,1)));
      qsa('.qtyDown').forEach(btn=>btn.addEventListener('click',()=>changeQty(btn.dataset.code,-1)));
      qsa('.qtyInput').forEach(inp=>inp.addEventListener('input',()=>setQty(inp.dataset.code,parseInt(inp.value||'0',10))));
    }

    function setQty(code, qty){
      const t = CONFIG.tickets.find(x=>x.code===code);
      const clamp = Math.max(0, Math.min(qty||0, (t && t.limit)||99));
      if (clamp===0) cart.delete(code); else cart.set(code, clamp);
      qsa(`.qtyInput[data-code="${code}"]`).forEach(i=>i.value=clamp);
      renderOrder();
    }
    function changeQty(code, d){ setQty(code, (cart.get(code)||0)+d); }
    function totals(){ let total=0; cart.forEach((qty,code)=>{ const t=CONFIG.tickets.find(x=>x.code===code); if (t) total += t.price*qty; }); return { total }; }
    function renderOrder(){
      const list = qs('#orderList'); if (list) list.innerHTML='';
      if (list) {
        if (cart.size===0) list.innerHTML = '<p class="text-slate-500">No tickets selected yet.</p>';
        else cart.forEach((qty,code)=>{ const t=CONFIG.tickets.find(x=>x.code===code); if (!t) { cart.delete(code); return; } const row=document.createElement('div'); row.className='flex items-center justify-between'; row.innerHTML=`<span class="text-sm">${t.name} √ó ${qty}</span><span class="text-sm font-medium">${fmt(t.price*qty)}</span>`; list.appendChild(row); });
      }
      const { total } = totals();
      qs('#total').textContent = fmt(total);
      qs('#totalMobile').textContent = fmt(total);
      const enable = total>0;
      ['#payBtnDesktop','#payBtnMobile'].forEach(sel=>{ const b=qs(sel); if(b){ b.disabled=!enable; }});
    }

    function goToCheckout(){
      // Save cart & config to storage for checkout page
      const items = Array.from(cart.entries()).map(([code,qty])=>({code,qty}));
      const payload = { items, savedAt: Date.now() };
      localStorage.setItem(STORAGE_KEYS.CART, JSON.stringify(payload));
      // Navigate
      window.location.href = 'checkout.html';
    }

    function boot(){
      renderHeader();
      renderTickets();
      renderOrder();
      qs('#payBtnDesktop').addEventListener('click', goToCheckout);
      qs('#payBtnMobile').addEventListener('click', goToCheckout);
    }
    document.addEventListener('DOMContentLoaded', boot, { once:true });
  </script>
</body>
</html>